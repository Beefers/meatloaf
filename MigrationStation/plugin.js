(function(d,r,h,S,C,w){"use strict";function l(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}function E(e){if(e&&e.__esModule)return e;var n=Object.create(null);return e&&Object.keys(e).forEach(function(t){if(t!=="default"){var a=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(n,t,a.get?a:{enumerable:!0,get:function(){return e[t]}})}}),n.default=e,Object.freeze(n)}var o=E(d),k=l(h),v=l(S),m=l(C);const{showToast:s}=r.findByProps("showToast");function D(e,n){let t=document.createElement("a");t.href=`data:,${encodeURIComponent(e)}`,t.setAttribute("download",n),t.click(),t.remove()}async function N(){return new Promise((e,n)=>{let t=document.createElement("input");t.setAttribute("accept","application/json"),t.setAttribute("type","file"),t.addEventListener("change",async()=>{e(await t.files[0].text())},!1),t.click()})}async function T(e){DiscordNative?DiscordNative.clipboard.copy(e):await navigator.clipboard.writeText(e)}async function g(){let e=[];for(const[n,t]of Object.entries(v.default.store||{})){let a={name:t.manifest.name,enabled:t.enabled,url:n},c=await k.default.get(`${n}_CUMCORD_STORE`);c&&(a.settings=c),e.push(a)}return e}async function p(e,n=s){for(let t of e)if(t.settings&&await cumcord.modules.internal.idbKeyval.set(`${t.url}_CUMCORD_STORE`,t.settings),cumcord.plugins.installed.ghost[t.url])try{cumcord.plugins.togglePlugin(t.url),cumcord.plugins.togglePlugin(t.url)}catch(a){cumcord.utils.logger.error("[MigrationStation]","Could not reload plugin",t.name,a),n({message:`Could not reload ${t.name}, check the console.`,id:`ms-${t.url}-err`,type:2})}else{try{await cumcord.plugins.importPlugin(t.url)}catch(a){cumcord.utils.logger.error("[MigrationStation]","Could not load plugin",t.url,a),n({message:`Could not load ${t.name}, check the console.`,id:`ms-${t.url}-err`,type:2})}t.enabled==!1&&cumcord.plugins.togglePlugin(t.url)}n({message:"Finished loading backup!",id:"ms-finish",type:1})}async function M(e){return`(${p})(${JSON.stringify(e??await g())}, cumcord.modules.webpack.findByProps("showToast").showToast)`}const i=r.findByProps("Sizes","Colors","Looks","DropdownSizes"),f=r.findByDisplayName("Card"),b=r.findByDisplayName("FormText"),y=r.findByDisplayName("FormTitle");function u({title:e,description:n,buttonText:t,buttonColor:a,buttonSize:c,buttonLook:j,buttonFunc:F}){return o.createElement(o.Fragment,null,o.createElement(f,{type:f.Types.PRIMARY,className:"beef-ms-settings-card"},o.createElement(y,{tag:y.Tags.H1},e),o.createElement(b,{className:"beef-ms-settings-card-description",type:b.Types.DESCRIPTION},n),o.createElement(i,{color:i.Colors[a]||i.Colors.BRAND,size:i.Sizes[c]||i.Sizes.SMALL,look:i.Looks[j]||i.Looks.FILLED,className:"beef-ms-settings-card-button",onClick:F},t)))}function O(){return o.createElement(o.Fragment,null,o.createElement("div",{className:"beef-ms-settings-card-container"},o.createElement(u,{title:"Backup",description:"Creates a backup of your current installation, including plugins and plugin nests.",buttonText:"Backup",buttonSize:"MEDIUM",buttonFunc:async()=>{await D(JSON.stringify(await g()),`backup-${Date.now()}.json`)}}),o.createElement(u,{title:"make big snippet very cool",description:"phorcys does not know how to make a submenu with react",buttonText:"Copy",buttonSize:"MEDIUM",buttonFunc:async()=>{try{await T(await M())}catch(e){s({message:"Could not copy to clipboard! :(",id:"ms-clipboard-error",type:2}),m.default.error("[MigrationStation]","Could not copy to clipboard",e)}finally{s({message:"Snippet was copied to clipboard successfully!",id:"ms-clipboard-success",type:1})}}}),o.createElement(u,{title:"Restore",description:"Restores from a backup of your current installation.",buttonText:"Restore",buttonSize:"MEDIUM",buttonFunc:async()=>{let e;try{e=JSON.parse(await N())}catch(n){s({message:"Could not open backup! :(",id:"ms-backup-error",type:2}),m.default.error("[MigrationStation]","Could not open backup",n)}finally{p(e)}}})))}var P=()=>w.injectCSS(".beef-ms-settings-card-container{display:flex;flex-direction:row;margin-bottom:.5rem}.beef-ms-settings-card-container .beef-ms-settings-card{width:100%;padding:20px;margin-left:.5rem}.beef-ms-settings-card-container .beef-ms-settings-card h1{margin-bottom:.25rem}.beef-ms-settings-card-container .beef-ms-settings-card .beef-ms-settings-card-description{margin-bottom:2rem}.beef-ms-settings-card-container .beef-ms-settings-card .beef-ms-settings-card-button{position:absolute;bottom:0;right:0;margin:.5rem}"),R=()=>{const e=[P()];return{onUnload(){_.forEachRight(e,n=>n())},settings:d.createElement(O)}};return R})(cumcord.modules.common.React,cumcord.modules.webpack,cumcord.modules.internal.idbKeyval,cumcord.plugins.installed,cumcord.utils,cumcord.patcher);
